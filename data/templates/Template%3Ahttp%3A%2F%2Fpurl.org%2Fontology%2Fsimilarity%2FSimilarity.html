<semantic-query
  query=" SELECT DISTINCT ?element ?subject1 ?subject1Link ?subject2 ?subject2Link ?providerLabelA ?providerLabelB ?imageA ?imageB WHERE {
                            ?imageA <http://purl.org/ontology/similarity/element> ??.
                            ?imageB <http://purl.org/ontology/similarity/element> ??.
                            ?subject1 <https://pharos.artresearch.net/custom/has_image> ?imageA.
                            ?subject2 <https://pharos.artresearch.net/custom/has_image> ?imageB.
                            ?subject1 <https://pharos.artresearch.net/custom/has_provider> ?providerA.
                            ?providerA rdfs:label ?providerLabelA.
                            ?subject2 <https://pharos.artresearch.net/custom/has_provider> ?providerB.
                            ?providerB rdfs:label ?providerLabelB.
                            BIND (STR(?subject1) as ?subject1Link)
                            BIND (STR(?subject2) as ?subject2Link)
                            BIND (?? as ?element)
                            FILTER (STR(?imageA)!=STR(?imageB))

                        } Limit 1"
  template="{{>matchingTemplate}}"
>
  <template id="matchingTemplate">
    <div class="instanceMatchingPage">
      <!-- Photos & similarity information -->
      <div class="pharosFieldViewer">
        <mp-event-target-template-render
          id="large-image-display"
          template="{{> largeImageDisplay}}"
        >
          <template id="largeImageDisplay">
            {{#ifCond imageA "&&" imageB}} 
                [[> rsp:MatchingCanditateImages element="{{element}}" imageA="{{imageA}}" imageB="{{imageB}}"]] 
            {{else}} 
                [[> rsp:MatchingCanditateImages element="{{bindings.0.element.value}}" imageA="{{bindings.0.imageA.value}}" imageB="{{bindings.0.imageB.value}}"]]
            {{/ifCond}}
          </template>
        </mp-event-target-template-render>

      </div>
      <semantic-query
      query='SELECT DISTINCT ?element ?imageA ?imageB ?thumbA ?thumbB WHERE{
                <{{bindings.0.subject1.value}}>  <https://pharos.artresearch.net/custom/has_image> ?imageA.
                BIND(REPLACE(STR(?imageA),"full/full","full/150,") AS ?thumbA).
                <{{bindings.0.subject2.value}}>  <https://pharos.artresearch.net/custom/has_image> ?imageB.
                BIND(REPLACE(STR(?imageB),"full/full","full/150,") AS ?thumbB).
                ?imageA <http://purl.org/ontology/similarity/element> ?element.
                ?imageB <http://purl.org/ontology/similarity/element> ?element.
            }'
      template="{{>imageAthumbs}}"
    >
      <template id="imageAthumbs">
        {{#ifCond (objectLength bindings) "!==" 1}}
        <small style="position: relative; width: 70%; left: -10%;">Click on the pairs to view photo similarities</small>
        <div class="imageFlex">

            {{#each bindings}}
            <mp-event-trigger
              id="event-trigger-image-a"
              type="Component.TemplateUpdate"
              data='{"element":"{{element.value}}","imageA":"{{imageA.value}}","imageB":"{{imageB.value}}"}'
              targets='["large-image-display"]'
            >
              <div class="thumbPairContainer">                  
                <img class="smallThumbsSingle" src="{{thumbA.value}}" />
                <img class="smallThumbsSingle" src="{{thumbB.value}}" />
              </div>
            </mp-event-trigger>
            {{/each}}
          </div>
          {{/ifCond}}
      </template>
    </semantic-query>
      <div class="matchContainer">
        <!-- Matching candidates fields comparison table -->
        <div class="fieldViewer">[[> rsp:MatchingCanditateFields]]</div>
      </div>
      <p></p>
      <p></p>

      <div class="sidebar">
        <semantic-query
          query=' SELECT ?element ?nextElement WHERE {
                                            ?imageA_next <http://purl.org/ontology/similarity/element> ?nextElement.
                                            ?imageB_next <http://purl.org/ontology/similarity/element> ?nextElement.
                                            ?subject1_next <https://pharos.artresearch.net/custom/has_image> ?imageA_next.
                                            ?subject2_next <https://pharos.artresearch.net/custom/has_image> ?imageB_next.
                                            ?imageA_next <http://www.cidoc-crm.org/cidoc-crm/P2_has_type> ?type.
                                            ?type rdfs:label "recto".
                                            FILTER(STR(?subject1_next)!=STR(?subject2_next))
                                            FILTER(STR(?element)!=STR(?nextElement))
                                            FILTER NOT EXISTS { ?nextElement <https://vision.artresearch.net/custom/reviewed> "true"^^xsd:boolean }
                                            BIND (<{{bindings.0.element.value}}> AS ?element)
                                        }LIMIT 1'
          template="{{>imageInfoTemplate}}"
        >
          <template id="imageInfoTemplate">
            <div class="actions">
              <button
                class="btn btn-default action optional"
                title="Two instances are the same"
              >
                Immitation
              </button>
              <button
                class="btn btn-default action optional"
                title="Two instances are the same"
              >
                Style of
              </button>
              <button
                class="btn btn-default action optional"
                title="Two instances are the same"
              >
                School of
              </button>
              <button
                class="btn btn-default action optional"
                title="Two instances are the same"
              >
                Study/Sketch of
              </button>
              <button
                class="btn btn-default action optional"
                title="Two instances are the same"
              >
                Same negative
              </button>
              <semantic-form
                new-subject-template="{{bindings.0.element.value}}"
                browser-persistance="true"
                persistence="sparql"
                post-action="{{bindings.0.nextElement.value}}"
                form-id="IMReject"
                fields='[[fieldDefinitions
                            reviewed="http://www.researchspace.org/fieldDefinition/Reviewed" 
                        ]]'
              >
                <semantic-form-hidden-input for="reviewed" default-value="true">
                </semantic-form-hidden-input>

                <button
                  name="submit"
                  class="btn btn-warning action reject"
                  title="Two instances are not the same"
                >
                  Not similar
                </button>
              </semantic-form>

              <semantic-form
                new-subject-template="{{bindings.0.element.value}}"
                browser-persistance="true"
                persistence="sparql"
                post-action="{{bindings.0.nextElement.value}}"
                form-id="IMApprove1"
                fields='[[fieldDefinitions
                                            reviewed="http://www.researchspace.org/fieldDefinition/Reviewed"
                                            sameAs="http://www.researchspace.org/fieldDefinition/Same"
                                            ]]'
              >
                <semantic-form-hidden-input
                  for="reviewed"
                  default-value="true"
                ></semantic-form-hidden-input>

                <semantic-form-hidden-input
                  for="sameAs"
                  default-value="{{bindings.0.subject_1.value}}"
                ></semantic-form-hidden-input>

                <button
                  id="1234"
                  name="submit"
                  class="btn btn-default action approve"
                  title="Two instances are the same"
                >
                  Same
                </button>
              </semantic-form>
            </div>
          </template>
        </semantic-query>
      </div>
    </div>
  </template>
</semantic-query>

<style>
  .semantic-form {
    margin: 2vh;
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    position: fixed;
    width: 20%;
    align-items: center;
    height: fit-content;
    right: 2%;
    bottom: 5%;
  }

  .instanceMatchingPage {
    display: flex;
    width: 100%;
    align-items: center;
    flex-direction: column;
  }

  .matchContainer {
    display: flex;
    width: 100%;
    flex-direction: column;
    justify-content: space-evenly;
  }

  .matchCandidate {
    width: 45vw;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 1vw;
  }

  .imageViewer {
    width: 100%;
    height: 45vh;
  }

  .fieldViewer {
    margin-top: 2vh;
    position: relative;
    width: 70%;
    left: 5%;
    height: fit-content;
    padding: 1vh 2vw 2vw 2vw;
    border-radius: 4px;
    box-shadow: 1px 6px 14px 3px lightgrey;
  }

  .pharosFieldViewer {
    display: flex;
    align-items: center;
    margin-top: 0vh;
    height: 50vh;
    justify-content: center;
    padding: 1vh 2vw 1vw 2vw;
    border-radius: 4px;
    background: #c1c1c161;
    overflow-y: scroll;
    align-self: center;
    margin-bottom: 3vh;
    position: relative;
    left: -10%;
    width: 70%;
  }

  .pharosFieldViewer button {
    margin: 1vh;
  }

  .pharosFieldViewer .simInfo {
    display: flex;
    font-size: medium;
  }

  .pharosFieldViewer .titleSimilarity {
    width: 31px;
    white-space: nowrap;
    font-weight: bold;
    overflow: hidden;
    text-overflow: clip;
  }

  .pharosFieldViewer img {
    width: 100%;
    height: 40vh;
    object-fit: contain;
    margin-top: 1vh;
    cursor: pointer;
  }

  .pharosFieldViewer .similarityInfo {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin: 1vw;
  }

  .rs-page-resource__field-label {
    font-weight: bold;
    font-size: medium;
  }

  .rs-page-resource__field-value {
    font-size: medium;
  }

  .actions {
    display: flex;
    justify-content: space-evenly;
    flex-direction: column;
    min-width: 200px;
    min-height: 200px;
    height: 85vh;
    background: #c1c1c161;
    border-radius: 4px;
    align-items: center;
    width: 30vh;
  }

  .actions .action {
    color: white !important;
    font-size: medium;
    border: none !important;
    min-height: 4vh;
    width: 8vw;
    min-width: 150px;
    box-shadow: 0px 0px 10px 1px #bebebe;
  }

  button.btn.btn-default.action.optional {
    background: #00a698;
  }

  .actions .action:hover {
    box-shadow: 0px 0px 10px 1px #383838;
  }

  .approve {
    background-color: #007bff !important;
  }

  .reject {
    background-color: #6c757d !important;
  }

  .imageFlex {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    flex-wrap: wrap;
    overflow-y: scroll;
    height: 12vh;
    position: relative;
    left: -10%;
    width: 70%;
}
.thumbPairContainer{
    cursor: pointer;
    margin-right: 1vw;
    padding: 15px;
    box-shadow: 1px 1px 9px 0px lightgrey;
    transition: 0.3s;
    border-radius: 4px;
    height: 100px;
    display: flex;
    align-items: center;
}
.thumbPairContainer:hover{
  box-shadow: 1px 1px 9px 0px darkgray;
}
  .smallThumbsSingle {
    height: 8vh !important;
    width: unset !important;
    max-width: 65px;
    max-height: unset !important;
    margin-right: 5px;
    object-fit: contain;
    background: #e7e7e7;
  }
  .sourceIcon {
    border-top-left-radius: 100% !important;
    border-top-right-radius: 100% !important;
    margin-top: 0 !important;
    border: none !important;
    height: 18px !important;
    width: 18px !important;
    padding: 2px !important;
    margin-right: 15px !important;
    border-radius: 100% !important;
    box-shadow: 1px 1px 3px 1px #e7e7e7 !important;
  }
</style>
